# Internet Of Things

### Autor/res
- Alvaro Schneider - [Perfil Linkedin](https://ar.linkedin.com/in/alvaro-schneider-99b61513 "Linkedin de Alvaro")

### Version
1.0.0

### Objetivo
Facilitar la configuración de dispositivos IoT mediante un lenguaje especifico DSL orientado a usuarios. Este lenguaje sirve para comunicarse con el midleware que está desarrollado en tecnologia Java.
Dicho lenguaje debe permitir modelar dispositivos como sensores, actuadores, procesadores y otros.
Debe ser sencillo, claro y entendible para que cualquier usuario sin conocimientos informáticos pueda utilizarlo, y así, modelar los diferentes comportamientos de dichos dispositivos IoT.

### Alcance
#####Incluye
- Codigo xtext: gramatica con extensión .xtext contiene lo siguente
	- Jerarquía/herencia de Dispositivos
	- Etiquetas
	- Estados para un Dispositivo
	- Transiciones
	- Eventos

- Codigo xtend: generador de codigo a partir de la gramatica
	
    Creará dinamicamente el codigo Java correspondiente a lo definido por el usuario desde el programa basado en el lenguaje Iot.

### Caracteristicas
Es un lenguaje de alto nivel que sirve para interactuar con dispositivos con API Java. Puede modelar dispositivos y sus principales caracteristicas. Por ejemplo, un dispositivo puede contar con etiquetas, estados, eventos y transiciones entre estados.

### Gramatica
```sh
    grammar org.slf.Iot with org.eclipse.xtext.common.Terminals

    generate iot "http://www.slf.org/Iot"

    Model:
	    dispositivos+=Dispositivo*;

    Dispositivo:
	    'dispositivo' name=ID ('extends' superType=[Dispositivo])? '{'
	    etiquetas+=Etiqueta*
	    estados+=Estado*
	    eventos+=Evento*
	    transiciones+=Transicion*
	    '}';

    Etiqueta:
    	typeName=('etiqueta') name=ID ('=' value=STRING)?;

    Evento:
	    typeName=('evento') name=ID;

    Estado:
	    'estado' name=ID '{'
	    elementos+=AbstractElement*
	    '}';

    Transicion:
    	evento=[Evento] '=>' estado=[Estado];

    AbstractElement:
    	Variable | Expression | IfStatement;
	
    IfStatement:
	    'if' '(' expression=Expression ')' thenBlock=IfBlock
	    (=>'else' elseBlock=IfBlock)?;

    IfBlock:
	    elementos += AbstractElement
	    | '{' elementos += AbstractElement+ '}';

    Variable:
    	name=ID '=' expression=Expression;

    Expression:
    	Or;

    Or returns Expression:
    	And ({Or.left=current} "||" right=And)*;

    And returns Expression:
    	Equality ({And.left=current} "&&" right=Equality)*;

    Equality returns Expression:
	    Comparison ({Equality.left=current} op=("==" | "!=")
	    right=Comparison)*;

    Comparison returns Expression:
    	PlusOrMinus ({Comparison.left=current} op=(">=" | "<=" | ">" | "<")
    	right=PlusOrMinus)*;

    PlusOrMinus returns Expression:
    	MulOrDiv (({Plus.left=current} '+' | {Minus.left=current} '-')
    	right=MulOrDiv)*;

    MulOrDiv returns Expression:
    	Primary ({MulOrDiv.left=current} op=('*' | '/')
    	right=Primary)*;

    Primary returns Expression:
    	'(' Expression ')' |
    	{Not} "!" expression=Primary |
	    Atomic;

    Atomic returns Expression:
	    {IntConstant} value=INT |
	    {StringConstant} value=STRING |
	    {BoolConstant} value=('true' | 'false') |
	    {VariableRef} variable=[Variable];

```

### Generador de codigo Java
```sh
    /*
    * generated by Xtext
    */
    package org.slf.generator

    import org.eclipse.emf.ecore.resource.Resource
    import org.eclipse.xtext.generator.IFileSystemAccess
    import org.eclipse.xtext.generator.IGenerator
    import org.slf.iot.*

    /**
     * Generates code from your model files on save.
     * 
     * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
     */
    class IotGenerator implements IGenerator {
    
    	override void doGenerate(Resource resource, IFileSystemAccess fsa) {
    
    		for (e : resource.allContents.toIterable.filter(typeof(Dispositivo))) {
    			fsa.generateFile("iot/" + e.name + ".java", e.compile)
    			fsa.generateFile("interfaces/" + e.name + "I.java", e.compileI)
    		}
    	}
    
    	def compile(Dispositivo dispositivo) {
    		'''
    		package iot;
    		
    		import interfaces.*;
    		
    		public class «dispositivo.name» «IF dispositivo.superType != null»extends «dispositivo.superType.name» «ENDIF»{
    			«FOR etiqueta: dispositivo.etiquetas»
    				public static final String «etiqueta.name» = "«etiqueta.value»";
    			«ENDFOR»
    			
    			enum Eventos{
    				«FOR evento: dispositivo.eventos»
    					«evento.name», 
    				«ENDFOR»
    			}
    
    			public void run(Evento e){
    				
    				switch ( e ) {
    					«FOR transicion: dispositivo.transiciones»
    					case "«transicion.evento.name»":
    						estadoActual = new «transicion.estado.name» 
    					break;
    					«ENDFOR»
    				}
    			}
    			
    		}
    		
    	«FOR estado: dispositivo.estados»
    		private class «estado.name» implements «dispositivo.name»I{
    			public void handle(){
    				«FOR ele : estado.elementos»
    					«IF ele instanceof Variable»
    						«IF ele.expression instanceof IntConstant»
    							int «ele.name» = «(ele.expression as IntConstant).value»;
    						«ENDIF»
    						«IF ele.expression instanceof StringConstant»
    							String «ele.name» = "«(ele.expression as StringConstant).value»";
    						«ENDIF»
    						«IF ele.expression instanceof BoolConstant»
    							boolean «ele.name» = «(ele.expression as BoolConstant).value»;
    						«ENDIF»
    					«ENDIF»
    				«ENDFOR»
    			}
    		}	
    	«ENDFOR»
    		
    	'''
    	}
    
    	def compileI(Dispositivo dispositivo) {
    		'''
    		package interfaces;
    
    		public interface «dispositivo.name»I «IF dispositivo.superType != null»extends «dispositivo.superType.name» «ENDIF»{
    				public void handle();
    		}
    	'''
    	}
    }

```

### Ejemplo codigo fuente IOT
```sh
    dispositivo dispo1 { 
	etiqueta etiq1 = "text1"
	etiqueta etiq2 = "text2"
	
	estado estate1 { 
		entero = 20
		entero2 = 25 + 35
		resultado = entero + entero2
		texto = "texto1"
		if(resultado == 44){
			entero2 = 0
		}
	}
	
	estado estate2 {
		entero2 = 44
		disponible = true
		if (disponible){
			disponible = false
		}
	}
	
	evento eve1
	eve1 => estate2
    }

```

### Tecnologias
Software o literatura que da soporte al proyecto:
- [Xtext] - Framework para crear DSL
- [ANTLR] - Generador de Parsers y Lexers
- [eclipse] - IDE de programación



[Xtext]:https://eclipse.org/Xtext/
[ANTLR]:http://www.antlr.org
[eclipse]:https://eclipse.org/
